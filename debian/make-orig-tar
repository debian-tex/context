
tlnet=${1:-/home/norbert/public_html/tlnet}

basever=2021.03.05

verstr=`date +%Y%m%d`
pkg="context-${basever}.$verstr"
orig="context_${basever}.$verstr.orig.tar.gz"

if [ -r $pkg ] ; then
  echo "already here: $pkg"
  exit 1
fi

unpackone() {
  what=$1
  for i in "" .doc .source .i386-linux ; do
    fn="$tlnet/archive/$what${i}.tar.xz"
    if [ -r "$fn" ] ; then
      echo "unpacking $fn"
      tar -xf "$fn"
    fi
  done
}

echo "installing from $tlnet"

mkdir $pkg
cd $pkg
unpackone context
# remove win32 stubs
rm -r texmf-dist/scripts/context/stubs/mswin/
rm -r texmf-dist/scripts/context/stubs/win64/
#
# remove non-free files for the moment
# replaced in TL already
#rm -rf texmf-dist/tex/context/colors/icc/profiles/*

for i in texmf-dist/doc/context/sources/general/manuals/mcommon.tex \
texmf-dist/doc/context/sources/general/manuals/pagecolumns/pagecolumns-000.tex \
texmf-dist/doc/context/sources/general/manuals/pagecolumns/pagecolumns-007.tex \
texmf-dist/doc/context/sources/general/manuals/pagecolumns/pagecolumns-004.tex \
texmf-dist/doc/context/sources/general/manuals/pagecolumns/pagecolumns-003.tex \
texmf-dist/doc/context/sources/general/manuals/pagecolumns/pagecolumns-006.tex \
texmf-dist/doc/context/sources/general/manuals/pagecolumns/pagecolumns-005.tex \
texmf-dist/doc/context/sources/general/manuals/pagecolumns/pagecolumns-001.tex \
texmf-dist/doc/context/sources/general/manuals/pagecolumns/pagecolumns-002.tex \
texmf-dist/doc/context/sources/general/manuals/details/detcow.tex \
texmf-dist/doc/context/sources/general/manuals/details/back-0.tex \
texmf-dist/doc/context/sources/general/manuals/details/detcow.mp \
texmf-dist/doc/context/sources/general/manuals/metafun/mycow.mp \
texmf-dist/doc/context/sources/general/manuals/metafun/mfun-800.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-colofon-paper.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/mfun-700.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/mfun-900.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-styles.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-graphics.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-basics.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/mfun-771.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/mfun-902.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/mfun-775.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-functions.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-examples.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-introduction.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-colofon-screen.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-effects.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-lua.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-layout.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-text-lmtx.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-syntax.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/mfun-901.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-macros.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/mfun-772.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-text.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/gracht.mp \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-gadgets.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-positioning.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/mfun-773.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-sneaky.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-contents.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-titlepage-paper.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-document.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-colofon.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-backpage.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/mfun-776.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-conventions.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-reference.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-titlepage-screen.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-debugging.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-backgrounds.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-welcome.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/mfun-774.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-environment.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-embedding.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-environment-screen.tex \
texmf-dist/doc/context/sources/general/manuals/metafun/metafun-index.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-005.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-803.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-204.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-902.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-405.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-802.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-702.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-701.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-404.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-203.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-703.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-004.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-205.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-007.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-206.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-901.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-903.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-301.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-401.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-202.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-003.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-006.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-001.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-704.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-000.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-002.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-201.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-101.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-402.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-103.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-801.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-102.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-805.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-601.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-403.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-804.tex \
texmf-dist/doc/context/sources/general/manuals/columnsets/columnsets-806.tex \
do rm $i; done

cd ..

GZIP=-9 tar -czf $orig $pkg

